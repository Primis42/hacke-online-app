<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Hacke – Pot Rechner</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .app {
      margin-top: 40px;
      background: #020617;
      border-radius: 18px;
      padding: 24px 28px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      max-width: 700px;
      width: 100%;
      box-sizing: border-box;
    }

    h1 {
      margin-top: 0;
      font-size: 1.6rem;
      margin-bottom: 0.25rem;
    }

    .subtitle {
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .section-title {
      margin-top: 1.2rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 0.95rem;
      color: #e5e7eb;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 0.5rem;
    }

    .label {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      box-sizing: border-box;
      font-size: 0.9rem;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #4ade80;
      box-shadow: 0 0 0 1px rgba(74, 222, 128, 0.4);
    }

    .card {
      border-radius: 12px;
      padding: 10px 12px;
      background: #020617;
      border: 1px solid #111827;
    }

    .player-card {
      border-radius: 12px;
      padding: 8px 10px;
      background: #020617;
      border: 1px solid #111827;
      font-size: 0.85rem;
    }

    .player-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 0.8rem;
    }

    .row input[type="radio"],
    .row input[type="checkbox"] {
      transform: scale(0.9);
      accent-color: #22c55e;
    }

    button {
      margin-top: 12px;
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 16px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg,#22c55e,#4ade80);
      color: #020617;
      box-shadow: 0 15px 30px rgba(34,197,94,0.3);
    }

    button:hover {
      filter: brightness(1.05);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 10px 20px rgba(34,197,94,0.25);
    }

    .output {
      margin-top: 16px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 0.85rem;
      white-space: pre-line;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #1f2937;
      font-size: 0.7rem;
      margin-left: 4px;
      color: #9ca3af;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      margin-left: 4px;
      background: #022c22;
      color: #6ee7b7;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Hacke – Rundenrechner</h1>
    <div class="subtitle">
      Trage Pot, Hacker, Mitgeher und Stiche ein – der Rechner verteilt den Pot und berechnet die Zahlungen für die nächste Runde.
    </div>

    <div class="card">
      <div class="section-title">Aktueller Pot</div>
      <label class="label" for="pot">Pot (CHF)</label>
      <input type="number" id="pot" value="4" min="1" step="1" />
    </div>

    <div class="section-title">Spieler (A, B, C, D)</div>
    <div class="grid">
      <div class="player-card">
        <div class="player-name">A</div>
        <div class="row">
          <input type="radio" name="hacker" value="A" id="hackerA">
          <label for="hackerA">Hacker</label>
        </div>
        <div class="row">
          <input type="checkbox" id="mitA">
          <label for="mitA">Mitgehen</label>
        </div>
        <div class="label">Stiche</div>
        <input type="number" id="stichA" min="0" max="4" value="0" />
      </div>

      <div class="player-card">
        <div class="player-name">B</div>
        <div class="row">
          <input type="radio" name="hacker" value="B" id="hackerB">
          <label for="hackerB">Hacker</label>
        </div>
        <div class="row">
          <input type="checkbox" id="mitB">
          <label for="mitB">Mitgehen</label>
        </div>
        <div class="label">Stiche</div>
        <input type="number" id="stichB" min="0" max="4" value="0" />
      </div>

      <div class="player-card">
        <div class="player-name">C</div>
        <div class="row">
          <input type="radio" name="hacker" value="C" id="hackerC">
          <label for="hackerC">Hacker</label>
        </div>
        <div class="row">
          <input type="checkbox" id="mitC">
          <label for="mitC">Mitgehen</label>
        </div>
        <div class="label">Stiche</div>
        <input type="number" id="stichC" min="0" max="4" value="0" />
      </div>

      <div class="player-card">
        <div class="player-name">D</div>
        <div class="row">
          <input type="radio" name="hacker" value="D" id="hackerD">
          <label for="hackerD">Hacker</label>
        </div>
        <div class="row">
          <input type="checkbox" id="mitD">
          <label for="mitD">Mitgehen</label>
        </div>
        <div class="label">Stiche</div>
        <input type="number" id="stichD" min="0" max="4" value="0" />
      </div>
    </div>

    <button onclick="berechneRunde()">Runde auswerten</button>

    <div id="output" class="output"></div>
  </div>

  <script>
    function berechneRunde() {
      const pot = Number(document.getElementById('pot').value || 0);
      if (pot <= 0) {
        document.getElementById('output').innerText = 'Bitte einen gültigen Pot (CHF) eingeben.';
        return;
      }

      const players = ['A', 'B', 'C', 'D'];

      // Hacker bestimmen
      const hackerRadio = document.querySelector('input[name="hacker"]:checked');
      if (!hackerRadio) {
        document.getElementById('output').innerText = 'Bitte wähle einen Hacker aus.';
        return;
      }
      const hacker = hackerRadio.value;

      // Mitgeher & Stiche auslesen
      const mitGeher = {};
      const stiche = {};
      players.forEach(p => {
        mitGeher[p] = document.getElementById('mit' + p).checked;
        stiche[p] = Number(document.getElementById('stich' + p).value || 0);
      });

      // Teilnehmer (Hacker + Mitgeher)
      const teilnehmer = players.filter(p => p === hacker || mitGeher[p]);

      // Ziele erfüllt?
      const zielErreicht = {};
      teilnehmer.forEach(p => {
        if (p === hacker) {
          zielErreicht[p] = stiche[p] >= 2;
        } else if (mitGeher[p]) {
          zielErreicht[p] = stiche[p] >= 1;
        } else {
          zielErreicht[p] = false;
        }
      });

      const hackerHatGewonnen = zielErreicht[hacker];

      const gewinner = teilnehmer.filter(p => zielErreicht[p]);
      const gewinnerMitGeher = gewinner.filter(p => p !== hacker);
      const verliererMitGeher = teilnehmer.filter(p => p !== hacker && !zielErreicht[p]);

      // Auszahlungen aktueller Pot
      const gewinn = { A: 0, B: 0, C: 0, D: 0 };
      // Zahlungen für nächste Runde
      const naechsteZahlung = { A: 0, B: 0, C: 0, D: 0 };

      if (!hackerHatGewonnen) {
        // Hacker verliert
        // Aktueller Pot: geht an alle Mitgeher, die ihr Ziel schaffen, 50/50/...
        const gewinnerCount = gewinner.length;
        if (gewinnerCount > 0) {
          const share = pot / gewinnerCount;
          gewinner.forEach(p => {
            gewinn[p] += share;
          });
        }

        // Nächste Runde: Hacker zahlt doppelten Pot
        naechsteZahlung[hacker] += 2 * pot;

        // Jeder Verlierer-Mitgeher zahlt einfachen Pot
        verliererMitGeher.forEach(p => {
          naechsteZahlung[p] += pot;
        });

      } else {
        // Hacker gewinnt
        if (gewinnerMitGeher.length === 0) {
          // Hacker alleine: bekommt ganzen Pot
          gewinn[hacker] += pot;
        } else {
          // Geteiltes Spiel: Hacker + mind. 1 Mitgeher
          if (pot === 4 && gewinnerMitGeher.length === 2) {
            // Spezialfall: 4 CHF-Pot, 2 Mitgeher gewinnen -> 2 / 1 / 1
            gewinn[hacker] += 2;
            gewinnerMitGeher.forEach(p => {
              gewinn[p] += 1;
            });
          } else {
            // Standard: Hacker 2/3, Mitgeher teilen 1/3
            const hackerAnteil = (2 / 3) * pot;
            const mitGeherAnteilTotal = pot - hackerAnteil;
            const shareMit = mitGeherAnteilTotal / gewinnerMitGeher.length;

            gewinn[hacker] += hackerAnteil;
            gewinnerMitGeher.forEach(p => {
              gewinn[p] += shareMit;
            });
          }
        }

        // Nächste Runde: jeder Verlierer-Mitgeher zahlt einfachen Pot
        verliererMitGeher.forEach(p => {
          naechsteZahlung[p] += pot;
        });
      }

      // Ausgabe aufbereiten
      let text = '';
      text += `Hacker: ${hacker}\n`;
      text += `Mitgeher: ${players.filter(p => mitGeher[p]).join(', ') || '-'}\n`;
      text += `Teilnehmer: ${teilnehmer.join(', ')}\n\n`;

      text += 'Ziele:\n';
      teilnehmer.forEach(p => {
        const ziel = (p === hacker) ? 'mind. 2 Stiche' : 'mind. 1 Stich';
        text += `  ${p}: ${stiche[p]} Stiche (${ziel}) → ${zielErreicht[p] ? 'erfüllt ✅' : 'verfehlt ❌'}\n`;
      });
      text += '\n';

      text += `Aktueller Pot: ${pot.toFixed(2)} CHF\n\n`;
      text += 'Auszahlung dieser Runde:\n';
      players.forEach(p => {
        text += `  ${p}: ${gewinn[p].toFixed(2)} CHF\n`;
      });

      text += '\nZahlungen für die nächste Runde:\n';
      players.forEach(p => {
        text += `  ${p}: ${naechsteZahlung[p].toFixed(2)} CHF\n`;
      });

      document.getElementById('output').innerText = text;
    }
  </script>
</body>
</html>
